Файловая система
===

# События файловой системы

Большинаство опреационных систем предаставляют возможность подписаться на события от файловой системы.
В Linux системах эта возможность предоставляется через библиотеку `initify`, 
в BSD системах (включая MacOS) эта возможность предоставляется самим ядром через `kqueue`.

Что бы подписаться на событие от файловой системы необходимо указать для какого файла и какие события вы хотите поймать.
При события последовательность получит массив где ключ - название файла, значение - тип события у файла.  
 
```php

ION\FS::watch('/etc/app/main.conf', ION\FS::WATCH_MODIFY)->then(function (array $files) {
    // цикл указан для демонстрации результата наблюдений за файловой системе
    // в нашем примере в нем нет необходимости так как мы слушаем только один файл и одно его событие
    foreach($files as $file => $event) {
        // $file == '/etc/app/main.conf'
        // $event == ION\FS::WATCH_MODIFY
    }
});
```

# Чтение файлов

Чтение файловой системы предоставляется силами библиотеки `libevent`, а конкретнее механизмом [sendfile](#). 
Хоть этот механизм и предназначен для копирования данных файла в сокет он отлично подходит для обычного ансинхронного чтения.
Если механизм `sendfile` не поддерживается, то будет использован механизм [mmap](#). 
Если не поддерживается `mmap` то будет обычное поточное чтение файла. 
Что бы узнать какой механиз будет использован посмотрите параметр `ion.engine.sendfile`, вызав `php --ri ion`.
 

Пример чтения файла через [корутину](./promisor.md#Корутины)

```php
$data = yield ION\FS::readFile('/etc/app/main.conf');
```

